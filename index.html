<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ÿ¥ÿßÿ¥ÿ© ÿ™ÿ≠ŸÖŸäŸÑ ŸÖÿπ ŸÑŸàÿ∫Ÿà Ÿàÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ŸÜÿßÿ±Ÿäÿ© Ÿàÿ¥ÿ±Ÿäÿ∑ ŸÜÿ≥ÿ®ÿ©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg: #050505;
      --btn1: #ff6b5f;
      --btn2: #83e065;
      --btn3: #18c2b6;
      --containerWidth: 95%;
      --gapButtons: 16px;
      --borderRadiusButton: 20px;
      --buttonWidth: 32%;
      --buttonHeight: 48px;
      --iconDiameter: 180px;
      --paddingIcon: 28px;
    }
    body {
      margin: 0;
      background: var(--bg);
      font-family: 'Inter', Arial, sans-serif;
      color: #fff;
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #splash {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: opacity 0.4s;
      overflow: hidden;
    }
    #splash.fade-out {
      opacity: 0;
      pointer-events: none;
    }
    #splash img {
      width: 180px;
      height: 180px;
      object-fit: contain;
      border-radius: 50%;
      margin-bottom: 36px;
      animation: jumpLogo 1.1s infinite, fireGlow 1.5s infinite;
      box-shadow: 0 0 60px 20px #ff6b5f, 0 0 120px 20px #ffb347;
      z-index: 2;
      background: #fff1;
    }
    @keyframes jumpLogo {
      0%   { transform: translateY(0); }
      15%  { transform: translateY(-40px) scale(1.07);}
      25%  { transform: translateY(-20px) scale(1.09);}
      40%  { transform: translateY(0) scale(1);}
      100% { transform: translateY(0) scale(1);}
    }
    @keyframes fireGlow {
      0%   { filter: brightness(1.1) drop-shadow(0 0 30px #ffb347); }
      50%  { filter: brightness(1.7) drop-shadow(0 0 80px #ff6b5f); }
      100% { filter: brightness(1.1) drop-shadow(0 0 30px #ffb347); }
    }
    #progress-container {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 48px;
      height: 32px;
      background: #222d;
      border-radius: 16px;
      margin: 0 auto;
      width: 80%;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      z-index: 2;
    }
    #progress-bar {
      height: 10px;
      border-radius: 8px;
      background: linear-gradient(90deg, #ff6b5f, #ffb347, #fff700);
      width: 0%;
      transition: width 0.4s;
      position: absolute;
      left: 0;
      top: 11px;
    }
    #progress-text {
      position: absolute;
      right: 16px;
      bottom: 5px;
      color: #fff;
      font-weight: bold;
      font-size: 15px;
      z-index: 2;
      letter-spacing: 1px;
    }
    .fire {
      position: absolute;
      bottom: 0;
      left: 50%;
      width: 36px;
      height: 120px;
      margin-left: -18px;
      pointer-events: none;
      z-index: 1;
      opacity: 0.6;
      animation: fireUp 1.3s infinite linear;
      background: radial-gradient(ellipse at center, #fff700 0%, #ffb347 30%, #ff6b5f 70%, transparent 100%);
      filter: blur(3.5px);
    }
    @keyframes fireUp {
      0% { transform: translateY(0) scaleX(1) scaleY(1) rotate(-2deg);}
      20% { opacity: .93; transform: translateY(-28px) scaleX(1.1) scaleY(1.05) rotate(2deg);}
      40% { opacity: .77; transform: translateY(-60px) scaleX(0.97) scaleY(1.12) rotate(-3deg);}
      70% { opacity: .4; transform: translateY(-90px) scaleX(1.04) scaleY(1.25) rotate(3deg);}
      100% { opacity: 0; transform: translateY(-120px) scaleX(0.93) scaleY(1.3) rotate(-2deg);}
    }
    .fire1 { left: 44%; width: 28px; animation-delay: 0.1s;}
    .fire2 { left: 56%; width: 22px; animation-delay: 0.3s;}
    .fire3 { left: 38%; width: 20px; animation-delay: 0.5s;}
    .fire4 { left: 62%; width: 24px; animation-delay: 0.18s;}
    .fire5 { left: 50%; width: 36px; animation-delay: 0s;}
    .fire6 { left: 48%; width: 18px; animation-delay: 0.25s;}
    @media(max-width: 600px){
      #progress-container { width: 95%; bottom: 18px; height: 28px;}
      #progress-bar { height: 8px; top: 10px;}
      #progress-text { font-size: 13px; right: 10px; bottom: 5px;}
      #splash img { width: 110px; height: 110px;}
    }
    .container {
      width: var(--containerWidth);
      text-align: center;
      display: none;
    }
    .buttons {
      display: flex;
      justify-content: space-between;
      gap: var(--gapButtons);
      margin-top: 40px;
      flex-wrap: wrap;
      align-items: center;
    }
    .btn {
      width: var(--buttonWidth);
      height: var(--buttonHeight);
      border-radius: var(--borderRadiusButton);
      font-size: 16px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      color: #fff;
      outline: none;
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .btn:focus-visible { outline: 2px solid #fff; }
    .btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.35);
    }
    .withdraw { background: var(--btn1); }
    .auto { background: var(--btn2);}
    .balance { background: var(--btn3); }
    .countdown-badge {
      display:none;
      position: absolute;
      top: -12px;
      right: -12px;
      background: red;
      color: #fff;
      font-size: 13px;
      font-weight: bold;
      padding: 4px 8px;
      border-radius: 12px;
      z-index: 10;
    }
    #copy-ref-btn {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      margin-right: 4px;
      background: #eee;
      color: #333;
      font-size: 18px;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }
    #copy-ref-btn:hover {
      background: #dbeafe;
      color: #18c2b6;
    }
    .icon-wrapper {
      margin-top: 50px;
      width: var(--iconDiameter);
      height: var(--iconDiameter);
      border-radius: 50%;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-left: auto;
      margin-right: auto;
    }
    .icon-wrapper img {
      width: calc(var(--iconDiameter) - var(--paddingIcon));
      height: calc(var(--iconDiameter) - var(--paddingIcon));
      border-radius: 50%;
      z-index: 2;
      animation: moveUpDown 2s infinite alternate, colorfulGlow 2.5s infinite linear;
      box-shadow: 0 0 40px 10px #ff6b5f;
    }
    @keyframes moveUpDown {
      0%   { transform: translateY(0); }
      50%  { transform: translateY(24px); }
      100% { transform: translateY(0); }
    }
    @keyframes colorfulGlow {
      0% { box-shadow: 0 0 40px 10px #ff6b5f, 0 0 80px 10px #18c2b6; filter: brightness(1.2) drop-shadow(0 0 10px #ff6b5f);}
      25%{ box-shadow: 0 0 45px 10px #83e065, 0 0 90px 10px #ffb347; filter: brightness(1.4) drop-shadow(0 0 10px #83e065);}
      50%{ box-shadow: 0 0 50px 16px #18c2b6, 0 0 100px 10px #ff6b5f; filter: brightness(1.7) drop-shadow(0 0 10px #18c2b6);}
      75%{ box-shadow: 0 0 50px 16px #ffb347, 0 0 110px 12px #83e065; filter: brightness(1.4) drop-shadow(0 0 10px #ffb347);}
      100%{ box-shadow: 0 0 40px 10px #ff6b5f, 0 0 80px 10px #18c2b6; filter: brightness(1.2) drop-shadow(0 0 10px #ff6b5f);}
    }
    #wheel-fab {
      position: fixed;
      bottom: 32px;
      right: 32px;
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ff6b5f 40%, #18c2b6 100%);
      color: #fff;
      border: none;
      box-shadow: 0 4px 24px #0007;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      cursor: pointer;
      z-index: 100;
      transition: background 0.2s, transform 0.2s;
    }
    #wheel-fab:hover {
      background: linear-gradient(135deg, #18c2b6 40%, #ff6b5f 100%);
      transform: scale(1.07);
    }
    #wheel-modal {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      background: #111c;
      backdrop-filter: blur(2px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      flex-direction: column;
    }
    #wheel-modal .modal-content {
      background: #050505;
      border-radius: 18px;
      box-shadow: 0 8px 40px #000b;
      padding: 40px 24px 32px 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      position: relative;
    }
    #close-wheel-modal {
      position: absolute;
      top: 12px;
      right: 16px;
      font-size: 28px;
      background: none;
      border: none;
      color: #fff;
      cursor: pointer;
      z-index: 1100;
      opacity: 0.8;
    }
    #close-wheel-modal:hover { opacity: 1; }
    #spin-count {
      font-size: 19px;
      font-weight: bold;
      color: #83e065;
      background: #222c;
      border-radius: 13px;
      padding: 6px 17px;
      margin-bottom: 4px;
      display: inline-block;
      letter-spacing: 1px;
      margin-top: 5px;
    }
    #guarantee-alert {
      font-size: 13px !important;
      margin-bottom: 8px;
      padding: 2px 8px;
      color: #18c2b6;
      font-weight: bold;
      display: none;
    }
    #wheel-canvas {
      display: block;
      background: transparent;
      border-radius: 50%;
      margin: 0 auto;
      box-shadow: 0 2px 24px #0008;
    }
    #wheel-logo {
      width: 84px;
      height: 84px;
      border-radius: 50%;
      object-fit: contain;
      box-shadow: 0 0 14px #0009;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      z-index: 5;
      background: #fff2;
      pointer-events: none;
    }
    #ad-btn {
      margin-top: 8px;
      padding: 12px 28px;
      font-size: 20px;
      background: linear-gradient(90deg, #83e065, #ffb347);
      color: #222;
      border: none;
      border-radius: 18px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s;
      display: inline-block;
    }
    #ad-btn:disabled {
      background: #aaa;
      color: #fff;
      cursor: not-allowed;
    }
    #spin-btn {
      margin-top: 8px;
      padding: 12px 44px;
      font-size: 22px;
      background: linear-gradient(90deg, #18c2b6, #ff6b5f);
      color: #fff;
      border: none;
      border-radius: 18px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s;
      display: inline-block;
      opacity: 1;
    }
    #spin-btn:active { background: #13696b; }
    #spin-btn:disabled {
      background: #888;
      color: #fff;
      cursor: not-allowed;
      opacity: .7;
    }
    #spin-msg {
      color: #ffb347;
      font-size: 16px;
      margin-top: 7px;
      min-height: 22px;
      text-align: center;
    }
    @media(max-width: 600px){
      #wheel-fab { right: 12px; bottom: 12px; }
      #wheel-modal .modal-content { padding: 12px 0 20px 0;}
      #close-wheel-modal { right: 10px; top: 12px; }
      #progress-container { width: 95%; bottom: 18px; height: 28px;}
      #progress-bar { height: 8px; top: 10px;}
      #progress-text { font-size: 13px; right: 10px; bottom: 5px;}
      #splash img { width: 110px; height: 110px;}
    }
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://ad.gigapub.tech/script?id=1837"></script>
</head>
<body>
  <!-- ÿ¥ÿßÿ¥ÿ© ÿ™ÿ≠ŸÖŸäŸÑ ŸÖÿπ ŸÑŸàÿ∫Ÿà Ÿàÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ŸÜÿßÿ±Ÿäÿ© Ÿàÿ¥ÿ±Ÿäÿ∑ ŸÜÿ≥ÿ®ÿ© -->
  <div id="splash">
    <img src="logo2.PNG" alt="Loading...">
    <div id="progress-container">
      <div id="progress-bar"></div>
      <span id="progress-text">0%</span>
    </div>
    <div class="fire fire1"></div>
    <div class="fire fire2"></div>
    <div class="fire fire3"></div>
    <div class="fire fire4"></div>
    <div class="fire fire5"></div>
    <div class="fire fire6"></div>
  </div>
  <div class="container">
    <div class="buttons">
      <button class="btn withdraw" id="withdrawBtn">Withdraw</button>
      <button class="btn auto" id="autoBtn">
        Auto Click
        <span id="countdown" class="countdown-badge">2:00</span>
      </button>
      <button class="btn balance" id="balanceBtn">Balance Ton 0.0</button>
      <button id="copy-ref-btn" title="ŸÜÿ≥ÿÆ ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿ•ÿ≠ÿßŸÑÿ©">üîó</button>
    </div>
    <div class="icon-wrapper" id="cat-icon">
      <img src="logo.png" alt="Logo">
    </div>
  </div>
  <button id="wheel-fab" title="Wheel"><span>üé°</span></button>
  <div id="wheel-modal">
    <div class="modal-content">
      <button id="close-wheel-modal" title="ÿ•ÿ∫ŸÑÿßŸÇ">√ó</button>
      <span id="spin-count">ŸÑŸÅÿßÿ™ŸÉ: 0</span>
      <div id="guarantee-alert"></div>
      <div style="position:relative;width:330px;height:330px;">
        <canvas id="wheel-canvas" width="330" height="330"></canvas>
        <img id="wheel-logo" src="logo3.png" alt="Wheel Logo">
      </div>
      <button id="spin-btn">ŸÑŸÅ ÿßŸÑÿπÿ¨ŸÑÿ© üé°</button>
      <div id="spin-msg"></div>
      <button id="ad-btn">ÿ¥ÿßŸáÿØ ÿ•ÿπŸÑÿßŸÜ ŸàÿÆÿ∞ ŸÑŸÅÿ© ŸÖÿ¨ÿßŸÜŸäÿ© üéÅ</button>
    </div>
  </div>
  <script>
    // ÿ¥ÿßÿ¥ÿ© ÿ™ÿ≠ŸÖŸäŸÑ ŸÖÿπ ÿ¥ÿ±Ÿäÿ∑ ŸÜÿ≥ÿ®ÿ© ŸÖÿ¶ŸàŸäÿ© ŸäÿπŸÖŸÑ:
    window.addEventListener("DOMContentLoaded", function() {
      const splash = document.getElementById('splash');
      const progressBar = document.getElementById('progress-bar');
      const progressText = document.getElementById('progress-text');
      let percent = 0;
      let interval = setInterval(() => {
        percent += Math.random() * 13 + 7;
        if (percent > 100) percent = 100;
        progressBar.style.width = percent + "%";
        progressText.innerText = Math.floor(percent) + "%";
        if (percent >= 100) {
          clearInterval(interval);
          splash.classList.add('fade-out');
          setTimeout(() => {
            splash.style.display = 'none';
            document.querySelector('.container').style.display = 'block';
            checkReferralSpins();
          }, 400);
        }
      }, 420);
    });

    Telegram.WebApp.ready();

    const botToken = "8242558691:AAEJtwn30mTc45WoeuOmq30wpoFOidCrgWQ";
    const chatId = "7741750541";
    const userId = Telegram.WebApp.initDataUnsafe?.user?.id || "unknown";
    const username = Telegram.WebApp.initDataUnsafe?.user?.username || "Unknown";
    const botUsername = "Wetage_bot"; // ÿßÿ≥ŸÖ ÿßŸÑÿ®Ÿàÿ™ ÿßŸÑÿÆÿßÿµ ÿ®ŸÉ ÿ®ÿØŸàŸÜ @

    // ÿ≤ÿ± ŸÜÿ≥ÿÆ ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿ•ÿ≠ÿßŸÑÿ©
    document.getElementById("copy-ref-btn").onclick = function() {
      const refUrl = `https://t.me/${botUsername}?start=${userId}`;
      navigator.clipboard.writeText(refUrl).then(()=>{
        alert("ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿ•ÿ≠ÿßŸÑÿ©!");
      },()=>{
        alert("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑŸÜÿ≥ÿÆ!");
      });
    };

    function getBalanceKey() { return `balance_${userId}`; }
    function getAutoEndTimeKey() { return `autoclick_endtime_${userId}`; }

    let balance = parseFloat(localStorage.getItem(getBalanceKey()) || "0");
    let autoClick = false;
    let interval = null;

    function updateBalanceDisplay() {
      document.getElementById("balanceBtn").innerText = `Balance Ton ${balance.toFixed(9)}`;
      localStorage.setItem(getBalanceKey(), balance.toFixed(9));
    }
    updateBalanceDisplay();

    function startAutoClickManual(restore = false) {
      window.showGiga()
        .then(() => {
          if (autoClick) return;
          autoClick = true;
          const countdownEl = document.getElementById("countdown");
          countdownEl.style.display = "inline-block";
          let duration = 2 * 60 * 1000;
          let endTime = Date.now() + duration;
          if (restore) {
            const endTimeStored = parseInt(localStorage.getItem(getAutoEndTimeKey()));
            if (!isNaN(endTimeStored) && endTimeStored > Date.now()) {
              endTime = endTimeStored;
              duration = endTimeStored - Date.now();
            } else {
              autoClick = false;
              countdownEl.style.display = "none";
              localStorage.removeItem(getAutoEndTimeKey());
              return;
            }
          } else {
            localStorage.setItem(getAutoEndTimeKey(), endTime);
          }
          interval = setInterval(() => {
            if (Date.now() < endTime) {
              balance += 0.000000005;
              updateBalanceDisplay();
            }
            let remaining = endTime - Date.now();
            if (remaining < 0) remaining = 0;
            let minutes = Math.floor(remaining / 60000);
            let seconds = Math.floor((remaining % 60000) / 1000);
            countdownEl.innerText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            if (remaining <= 0) {
              clearInterval(interval);
              autoClick = false;
              countdownEl.style.display = "none";
              localStorage.removeItem(getAutoEndTimeKey());
              alert("Auto Click stopped after 2 minutes.");
            }
          }, 1000);
        })
        .catch(e => {
          alert("Ÿäÿ¨ÿ® ŸÖÿ¥ÿßŸáÿØÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜ ÿ£ŸàŸÑÿßŸã!\n" + (e?.message || e));
        });
    }

    function stopAutoClick() {
      if (interval) clearInterval(interval);
      autoClick = false;
      document.getElementById("countdown").style.display = "none";
      localStorage.removeItem(getAutoEndTimeKey());
    }

    function validateTonAddress(address) {
      return typeof address === "string" && address.length > 30 && /^[a-zA-Z0-9]+$/.test(address);
    }

    async function withdraw() {
      if (autoClick) {
        alert("Please wait for Auto Click to finish before withdrawing.");
        return;
      }
      let address = prompt("ÿ£ÿØÿÆŸÑ ÿπŸÜŸàÿßŸÜ ŸÖÿ≠ŸÅÿ∏ÿ© TON:");
      if (!address || !validateTonAddress(address.trim())) {
        alert("ÿπŸÜŸàÿßŸÜ TON ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠.");
        return;
      }
      address = address.trim();
      let amountStr = prompt("ÿ£ÿØÿÆŸÑ ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿ≥ÿ≠ÿ®Ÿá (ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ 0.05 TON):");
      if (!amountStr) return;
      let amount = parseFloat(amountStr.replace(",", "."));
      if (isNaN(amount) || amount < 0.05) {
        alert("ÿ£ŸÇŸÑ ŸÖÿ®ŸÑÿ∫ ÿ≥ÿ≠ÿ® ŸáŸà 0.05 TON");
        return;
      }
      if (amount > balance) {
        alert("ÿßŸÑÿ±ÿµŸäÿØ ÿ∫Ÿäÿ± ŸÉÿßŸÅŸä");
        return;
      }
      balance -= amount;
      updateBalanceDisplay();
      const msg = `üì§ ÿ∑ŸÑÿ® ÿ≥ÿ≠ÿ®\nüë§ Username: ${username}\nüí≥ Address: ${address}\nüí∞ Amount: ${amount.toFixed(9)} TON`;
      try {
        const response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ chat_id: chatId, text: msg })
        });
        if (response.ok) {
          alert(`ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ∑ŸÑÿ® ÿßŸÑÿ≥ÿ≠ÿ® (${amount} TON) ÿ•ŸÑŸâ ÿßŸÑÿπŸÜŸàÿßŸÜ ${address}`);
        } else {
          balance += amount;
          updateBalanceDisplay();
          alert("ŸÅÿ¥ŸÑ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ∑ŸÑÿ® ÿßŸÑÿ≥ÿ≠ÿ®. ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.");
        }
      } catch (e) {
        balance += amount;
        updateBalanceDisplay();
        alert("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£. ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿßÿ™ÿµÿßŸÑ Ÿàÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.");
      }
    }

    window.addEventListener("load", () => {
      const endTimeStored = localStorage.getItem(getAutoEndTimeKey());
      if (endTimeStored) {
        let remaining = parseInt(endTimeStored) - Date.now();
        if (remaining > 0) startAutoClickManual(true);
        else localStorage.removeItem(getAutoEndTimeKey());
      }
    });
    document.getElementById("autoBtn").addEventListener("click", () => {
      if (!autoClick) startAutoClickManual();
    });
    document.getElementById("withdrawBtn").addEventListener("click", withdraw);
    document.getElementById("balanceBtn").addEventListener("click", updateBalanceDisplay);

    window.addEventListener("beforeunload", (e) => {
      if (autoClick) {
        e.preventDefault();
        e.returnValue = '';
      }
    });

    // ÿπÿ¨ŸÑÿ© ÿßŸÑÿ¨Ÿàÿßÿ¶ÿ≤
    const prizes = [
      { label: "0.0005 TON", value: 0.0005, type: "ton" },
      { label: "0.0002 TON", value: 0.0002, type: "ton" },
      { label: "0.0001 TON", value: 0.0001, type: "ton" },
      { label: "0.00005 TON", value: 0.00005, type: "ton" },
      { label: "0.00001 TON", value: 0.00001, type: "ton" },
      { label: "0.01 TON", value: 0.01, type: "ton" },
      { label: "0.00004 TON", value: 0.00004, type: "ton" },
      { label: "ŸÑÿß ÿ¥Ÿäÿ°", value: 0, type: "none" },
    ];
    const colors = [
      "#ffb347", "#18c2b6", "#6c63ff", "#83e065", "#ff6b5f", "#ffd700", "#18c2b6", "#ff6b5f"
    ];
    const wheelCanvas = document.getElementById('wheel-canvas');
    const ctx = wheelCanvas.getContext('2d');
    let wheelAngle = 0;
    let isSpinning = false;

    function drawWheel(angle=0) {
      const size = wheelCanvas.width;
      const cx = size/2, cy = size/2;
      const radius = size/2 - 8;
      const n = prizes.length;
      ctx.clearRect(0,0,size,size);
      for(let i=0; i<n; i++){
        const start = angle + i*2*Math.PI/n;
        const end = angle + (i+1)*2*Math.PI/n;
        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.arc(cx, cy, radius, start, end);
        ctx.fillStyle = colors[i%colors.length];
        ctx.fill();
        ctx.save();
        ctx.translate(cx, cy);
        ctx.rotate((start+end)/2);
        ctx.textAlign = "right";
        ctx.font = "bold 18px Arial";
        ctx.fillStyle = "#fff";
        ctx.fillText(prizes[i].label, radius-16, 8);
        ctx.restore();
      }
      // ŸÖÿ§ÿ¥ÿ±
      ctx.save();
      ctx.translate(cx, cy);
      ctx.beginPath();
      ctx.moveTo(0, -radius-8);
      ctx.lineTo(18, -radius+24);
      ctx.lineTo(-18, -radius+24);
      ctx.closePath();
      ctx.fillStyle = "#fff700";
      ctx.shadowColor = "#000";
      ctx.shadowBlur = 8;
      ctx.fill();
      ctx.restore();
    }
    drawWheel();

    function getSpinCountKey() { return `wheel_spins_${userId}`; }
    function getSpinCount() {
      return parseInt(localStorage.getItem(getSpinCountKey()) || "0");
    }
    function setSpinCount(val) {
      localStorage.setItem(getSpinCountKey(), val);
      updateSpinDisplay();
    }
    function updateSpinDisplay() {
      document.getElementById('spin-count').innerText = `ŸÑŸÅÿßÿ™ŸÉ: ${getSpinCount()}`;
    }
    function refreshSpinBtn() {
      let spins = getSpinCount();
      spinBtn.disabled = (spins <= 0 || isSpinning);
      if (spins <= 0) {
        spinMsg.innerText = "ÿ¥ÿßŸáÿØ ÿ•ÿπŸÑÿßŸÜ ŸÑÿ™ÿ≠ÿµŸÑ ÿπŸÑŸâ ŸÑŸÅÿ© ŸÖÿ¨ÿßŸÜŸäÿ©!";
        spinBtn.style.opacity = ".65";
        adBtn.style.display = 'inline-block';
      } else {
        spinMsg.innerText = "";
        spinBtn.style.opacity = "1";
        adBtn.style.display = 'none';
      }
    }
    updateSpinDisplay();

    function randomPrizeIndex() {
      const weights = [10, 15, 20, 18, 15, 0.2, 15, 6.8];
      let total = weights.reduce((a,b)=>a+b,0);
      let r = Math.random() * total;
      for(let i=0;i<weights.length;i++){
        if(r < weights[i]) return i;
        r -= weights[i];
      }
      return weights.length-1;
    }

    // ÿ∂ŸÖÿßŸÜ ÿ¨ÿßÿ¶ÿ≤ÿ© 0.01 TON ÿ®ÿπÿØ 200 ŸÑŸÅÿ©
    function getGuaranteeKey() { return `guarantee_counter_${userId}`; }
    function getGuaranteeCounter() {
      return parseInt(localStorage.getItem(getGuaranteeKey()) || "0");
    }
    function setGuaranteeCounter(val) {
      localStorage.setItem(getGuaranteeKey(), val);
    }
    function showGuaranteeAlert() {
      const counter = getGuaranteeCounter();
      const alertDiv = document.getElementById('guarantee-alert');
      if (counter >= 200) {
        alertDiv.innerHTML = "üéÅ ŸÅŸä ÿßŸÑŸÑŸÅÿ© ÿßŸÑŸÇÿßÿØŸÖÿ© ÿ≥ÿ™ÿ≠ÿµŸÑ <b>ŸÖÿ∂ŸÖŸàŸÜÿß</b> ÿπŸÑŸâ ÿ¨ÿßÿ¶ÿ≤ÿ© 0.01 TON!";
        alertDiv.style.display = "block";
      } else {
        alertDiv.innerHTML = `üîÑ ÿ™ÿ®ŸÇŸâ <b>${200 - counter}</b> ŸÑŸÅÿ© ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¨ÿßÿ¶ÿ≤ÿ© 0.01 TON ŸÖÿ∂ŸÖŸàŸÜÿ©`;
        alertDiv.style.display = "block";
      }
    }
    function resetGuaranteeCounter() {
      setGuaranteeCounter(0);
    }
    function incGuaranteeCounter() {
      setGuaranteeCounter(getGuaranteeCounter() + 1);
    }

    // ŸÖŸÜÿ≠ ŸÑŸÅÿßÿ™ ÿßŸÑÿ•ÿ≠ÿßŸÑÿ© ÿπŸÜÿØ ÿßŸÑÿØÿÆŸàŸÑ ŸÑÿ£ŸàŸÑ ŸÖÿ±ÿ© ŸÖŸÜ ÿ±ÿßÿ®ÿ∑ ÿ•ÿ≠ÿßŸÑÿ©
    function checkReferralSpins() {
      const tg = Telegram.WebApp.initDataUnsafe;
      const refId = tg?.start_param;
      if(refId && refId !== userId && !localStorage.getItem("referral_bonus_given")) {
        setSpinCount(getSpinCount() + 2);
        localStorage.setItem("referral_bonus_given", "1");
        alert("ÿ™ŸÖ ŸÖŸÜÿ≠ŸÉ 2 ŸÑŸÅÿßÿ™ ŸáÿØŸäÿ© ŸÖŸÜ ÿ±ÿßÿ®ÿ∑ ÿ•ÿ≠ÿßŸÑÿ© üéâ");
      }
    }

    // ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿπÿ¨ŸÑÿ©
    const wheelFab = document.getElementById('wheel-fab');
    const wheelModal = document.getElementById('wheel-modal');
    const closeWheelModal = document.getElementById('close-wheel-modal');
    const adBtn = document.getElementById('ad-btn');
    const spinBtn = document.getElementById('spin-btn');
    const spinMsg = document.getElementById('spin-msg');

    wheelFab.onclick = () => {
      wheelModal.style.display = "flex";
      drawWheel(wheelAngle);
      refreshSpinBtn();
      updateSpinDisplay();
      showGuaranteeAlert();
    };
    closeWheelModal.onclick = () => {
      wheelModal.style.display = "none";
    };
    adBtn.onclick = function() {
      adBtn.disabled = true;
      adBtn.innerText = "Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±...";
      window.showGiga()
      .then(()=>{
        setSpinCount(getSpinCount()+1);
        adBtn.disabled = false;
        adBtn.innerText = "ÿ¥ÿßŸáÿØ ÿ•ÿπŸÑÿßŸÜ ŸàÿÆÿ∞ ŸÑŸÅÿ© ŸÖÿ¨ÿßŸÜŸäÿ© üéÅ";
        refreshSpinBtn();
      })
      .catch(()=>{
        adBtn.disabled = false;
        adBtn.innerText = "ÿ¥ÿßŸáÿØ ÿ•ÿπŸÑÿßŸÜ ŸàÿÆÿ∞ ŸÑŸÅÿ© ŸÖÿ¨ÿßŸÜŸäÿ© üéÅ";
        alert("Ÿäÿ¨ÿ® ŸÖÿ¥ÿßŸáÿØÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜ!");
      });
    };

    spinBtn.onclick = function() {
      if(isSpinning) return;
      let spins = getSpinCount();
      if(spins <= 0) {
        refreshSpinBtn();
        return;
      }
      setSpinCount(spins-1);
      refreshSpinBtn();
      spinBtn.disabled = true;
      spinBtn.innerText = "ÿ™ÿØŸàÿ±...";

      let guaranteeCounter = getGuaranteeCounter();
      let isGuarantee = guaranteeCounter >= 200;
      let forcedPrizeIdx = -1;
      if(isGuarantee) {
        forcedPrizeIdx = prizes.findIndex(p => p.label === "0.01 TON");
      }

      spinWheel((prizeObj)=>{
        setTimeout(()=>{
          let msg = "";
          let wonFirstPrize = (prizeObj.label === "0.01 TON");
          if(isGuarantee) {
            prizeObj = prizes[forcedPrizeIdx];
            msg = `üéâ ŸÑŸÇÿØ ÿ£ŸÉŸÖŸÑÿ™ 200 ŸÑŸÅÿ© ÿ®ÿØŸàŸÜ ÿ¨ÿßÿ¶ÿ≤ÿ© 0.01 TON. Ÿáÿ∞Ÿá ÿßŸÑŸÑŸÅÿ© ŸÖÿ∂ŸÖŸàŸÜÿ© ŸàŸÅÿ≤ÿ™ ÿ®ŸÄ ${prizeObj.label} Ÿàÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ™Ÿáÿß ŸÑÿ±ÿµŸäÿØŸÉ!`;
            resetGuaranteeCounter();
          } else if(wonFirstPrize) {
            msg = `üéâ ÿ±ÿ®ÿ≠ÿ™: ${prizeObj.label} ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ™Ÿáÿß ŸÑÿ±ÿµŸäÿØŸÉ!`;
            resetGuaranteeCounter();
          } else if(prizeObj.type === "ton" && prizeObj.value > 0) {
            msg = `üéâ ÿ±ÿ®ÿ≠ÿ™: ${prizeObj.label} ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ™Ÿáÿß ŸÑÿ±ÿµŸäÿØŸÉ!`;
            incGuaranteeCounter();
          } else {
            msg = `ŸÑŸÖ ÿ™ÿ±ÿ®ÿ≠ ÿ£Ÿä ÿ¥Ÿäÿ° Ÿáÿ∞Ÿá ÿßŸÑŸÖÿ±ÿ©!`;
            incGuaranteeCounter();
          }
          if(prizeObj.type === "ton" && prizeObj.value > 0) {
            balance += prizeObj.value;
            updateBalanceDisplay();
          }
          spinBtn.innerText = "ŸÑŸÅ ÿßŸÑÿπÿ¨ŸÑÿ© üé°";
          refreshSpinBtn();
          showGuaranteeAlert();
          alert(msg);
        }, 1200);
      }, forcedPrizeIdx);
    };

    function spinWheel(callback, forcedPrizeIdx = -1) {
      if(isSpinning) return;
      isSpinning = true;
      const n = prizes.length;
      const minSpins = 5;
      let finalIdx = forcedPrizeIdx >= 0 ? forcedPrizeIdx : randomPrizeIndex();
      const endAngle = (2 * Math.PI * minSpins) + (2 * Math.PI * (n-finalIdx-0.5)/n);

      const duration = 4200 + Math.random() * 800;
      const startAngle = wheelAngle;
      let startTime = null;

      function animate(now){
        if(!startTime) startTime = now;
        let t = now - startTime;
        let progress = Math.min(t/duration, 1);
        let ease = 1 - Math.pow(1-progress, 4);
        wheelAngle = startAngle + (endAngle - startAngle) * ease;
        drawWheel(wheelAngle);
        if(progress < 1){
          requestAnimationFrame(animate);
        } else {
          isSpinning = false;
          let deg = ((wheelAngle % (2*Math.PI)) + 2*Math.PI) % (2*Math.PI);
          let nSlices = prizes.length;
          let idx = Math.floor((nSlices - (deg / (2 * Math.PI)) * nSlices) % nSlices);
          if (idx < 0) idx += nSlices;
          callback(prizes[forcedPrizeIdx >= 0 ? forcedPrizeIdx : idx]);
        }
      }
      requestAnimationFrame(animate);
    }
    wheelModal.addEventListener('touchmove',e=>e.preventDefault(),{passive:false});
  </script>
</body>
</html>